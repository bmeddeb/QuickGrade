{% extends "base.html" %}
{% load static %}

{% block title %}GitHub Dashboard - QuickGrade{% endblock %}
{% block page_id %}github-dashboard{% endblock %}
{% block header_subtitle %}GitHub Dashboard{% endblock %}

{% block content %}
<div class="mb-8 flex items-center justify-between">
  <div>
    <h1 class="text-2xl font-semibold">GitHub Dashboard</h1>
    <p class="mt-2 text-[var(--paper-muted)]">Analyze commits, pull requests, and collaboration</p>
  </div>
  <a href="{% url 'github:fetch' %}" class="paper-btn paper-btn-primary">
    <i class="nc-icon nc-cloud-download-93 mr-2"></i>
    Fetch Data
  </a>
</div>

{% if repositories %}
<!-- Stats Cards -->
<div class="grid gap-6 md:grid-cols-4 mb-8">
  <div class="paper-card p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-[var(--paper-muted)]">Repositories</p>
        <p class="text-3xl font-bold mt-1">{{ total_repos }}</p>
      </div>
      <div class="flex h-12 w-12 items-center justify-center rounded-full bg-[var(--paper-primary)]/10 text-[var(--paper-primary)]">
        <i class="fa fa-github text-xl"></i>
      </div>
    </div>
  </div>

  <div class="paper-card p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-[var(--paper-muted)]">Total Commits</p>
        <p class="text-3xl font-bold mt-1">{{ total_commits|default:0 }}</p>
      </div>
      <div class="flex h-12 w-12 items-center justify-center rounded-full bg-[var(--paper-info)]/10 text-[var(--paper-info)]">
        <i class="fa fa-code-fork text-xl"></i>
      </div>
    </div>
  </div>

  <div class="paper-card p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-[var(--paper-muted)]">Pull Requests</p>
        <p class="text-3xl font-bold mt-1">{{ total_prs|default:0 }}</p>
      </div>
      <div class="flex h-12 w-12 items-center justify-center rounded-full bg-[var(--paper-success)]/10 text-[var(--paper-success)]">
        <i class="fa fa-code-pull-request text-xl"></i>
      </div>
    </div>
  </div>

  <div class="paper-card p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-[var(--paper-muted)]">Issues</p>
        <p class="text-3xl font-bold mt-1">{{ total_issues|default:0 }}</p>
      </div>
      <div class="flex h-12 w-12 items-center justify-center rounded-full bg-[var(--paper-warning)]/10 text-[var(--paper-warning)]">
        <i class="fa fa-exclamation-circle text-xl"></i>
      </div>
    </div>
  </div>
</div>

<!-- Repository List -->
<div class="paper-card">
  <div class="p-6 border-b border-[var(--paper-border)]">
    <h2 class="text-lg font-semibold">Repositories</h2>
  </div>
  <div class="divide-y divide-[var(--paper-border)]">
    {% for repo in repositories %}
    <div class="p-6 hover:bg-[var(--paper-bg)] transition-colors">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="flex h-10 w-10 items-center justify-center rounded-full bg-[#24292e] text-white">
            <i class="fa fa-github"></i>
          </div>
          <div>
            <a href="{% url 'github:repository_detail' repo.id %}" class="font-semibold hover:text-[var(--paper-primary)]">
              {{ repo.full_name }}
            </a>
            <p class="text-sm text-[var(--paper-muted)]">
              {% if repo.description %}{{ repo.description|truncatechars:60 }}{% else %}No description{% endif %}
            </p>
          </div>
        </div>
        <div class="flex items-center gap-6 text-sm text-[var(--paper-muted)]">
          <span title="Commits"><i class="fa fa-code-fork mr-1"></i>{{ repo.commits.count }}</span>
          <span title="Pull Requests"><i class="fa fa-code-pull-request mr-1"></i>{{ repo.pull_requests.count }}</span>
          <span title="Issues"><i class="fa fa-exclamation-circle mr-1"></i>{{ repo.issues.count }}</span>
          <span class="{% if repo.fetch_status == 'success' %}text-[var(--paper-success)]{% elif repo.fetch_status == 'failed' %}text-[var(--paper-danger)]{% else %}text-[var(--paper-warning)]{% endif %}">
            {% if repo.fetch_status == 'success' %}
            <i class="nc-icon nc-check-2"></i>
            {% elif repo.fetch_status == 'failed' %}
            <i class="nc-icon nc-simple-remove"></i>
            {% else %}
            <i class="nc-icon nc-time-alarm"></i>
            {% endif %}
          </span>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% else %}
<!-- Empty State -->
<div class="paper-card p-12 text-center">
  <div class="flex h-20 w-20 items-center justify-center rounded-full bg-[var(--paper-bg)] mx-auto mb-6">
    <i class="fa fa-github text-4xl text-[var(--paper-muted)]"></i>
  </div>
  <h2 class="text-xl font-semibold mb-2">No Repositories Yet</h2>
  <p class="text-[var(--paper-muted)] mb-6 max-w-md mx-auto">
    Get started by fetching data from your GitHub repositories.
    You can upload an Excel file or paste repository URLs.
  </p>
  <a href="{% url 'github:fetch' %}" class="paper-btn paper-btn-primary">
    <i class="nc-icon nc-cloud-download-93 mr-2"></i>
    Fetch GitHub Data
  </a>
</div>
{% endif %}
{% endblock %}
